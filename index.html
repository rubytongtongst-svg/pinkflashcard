<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>æˆ‘çš„å•è¯æœ¬ (çº¯å‡€æµ…ç²‰ç‰ˆ)</title>
    <style>
        /* ğŸ¨ ç»Ÿä¸€æ‰€æœ‰ç²‰è‰²ä¸ºæœ€æµ…ã€æœ€æŸ”å’Œçš„è‰²è°ƒ */
        :root {
            --unified-pink: #ffc0cb; /* æœ€æµ…çš„ç²‰è‰² (Pink) */
            --unified-pink-light: #fff5ee; /* æ›´æµ…çš„ç²‰è‰²ä½œä¸ºèƒŒæ™¯ (SeaShell) */
            --bg-color: #fcfcfc; /* æ¥è¿‘ç™½è‰²ï¼Œä¿æŒæ¸…çˆ½ */
            --card-bg: #ffffff;
            --text-main: #333333; /* æ·±ç°æ–‡æœ¬ */
            --success-color: #66bb6a; /* æˆåŠŸç»¿ */
            --warning-color: #ffa726; /* è­¦å‘Šæ©™ */
            --danger-color: #ef5350; /* å±é™©çº¢ */
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        h1 { margin-bottom: 20px; font-size: 1.6rem; color: var(--unified-pink); } 

        /* --- å•è¯å¡åŒºåŸŸ --- */
        .scene {
            width: 100%;
            max-width: 400px;
            height: 260px;
            perspective: 1000px;
            margin: 20px 0;
            cursor: pointer;
        }

        .card {
            width: 100%;
            height: 100%;
            position: relative;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            border-radius: 16px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.05);
        }

        .card.is-flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            box-sizing: border-box;
            /* å•è¯å¡è¾¹æ¡†åŠ ç²—ä¸¤å€ */
            border: 8px solid var(--unified-pink); 
        }

        .card-face.front { font-size: 2.5rem; font-weight: 700; color: var(--text-main); } 
        .card-face.back { 
            transform: rotateY(180deg); 
            background-color: var(--unified-pink-light); 
            font-size: 1.8rem; 
            color: var(--text-main); 
        }

        .hint { font-size: 0.8rem; color: #94a3b8; margin-top: 10px; position: absolute; bottom: 15px;}

        /* --- æŒ‰é’®æ ·å¼ --- */
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .btn-nav { background-color: white; border: 1px solid #cbd5e1; color: #475569; }
        .btn-nav:hover { background-color: #f0f0f0; }

        /* æŒ‰é’®é¢œè‰²ç»Ÿä¸€æµ…ç²‰è‰² */
        .btn-check { background-color: var(--unified-pink); color: white; } 
        .btn-check:hover { background-color: #ffb1c0; } 
        
        .btn-new-deck, .btn-add { background-color: var(--unified-pink); color: white; }
        .btn-new-deck:hover, .btn-add:hover { background-color: #ffb1c0; } 

        .btn-del { background-color: #ffe0e0; color: var(--danger-color); }
        .btn-warn { background-color: #fff8e1; color: var(--warning-color); border: 1px solid #ffcc80; } 
        .btn-warn:hover { background-color: #ffedc1; }

        /* --- å¸ƒå±€å®¹å™¨ --- */
        
        .deck-controls {
            display: flex;
            gap: 10px;
            width: 100%;
            max-width: 400px;
            justify-content: flex-end;
            margin-bottom: 15px; 
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }
        
        /* --- æ‰“å­—æµ‹è¯•åŒºæ ·å¼ --- */
        .typing-section {
            width: 100%;
            max-width: 400px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }
        .typing-section h3 { margin-top: 0; font-size: 1.1rem; color: var(--text-main);}
        .typing-input-group {
            display: flex;
            gap: 10px;
        }
        #answerInput {
            flex-grow: 1;
            padding: 10px;
            /* è¾“å…¥æ¡†è¾¹æ¡†ä¹Ÿæ”¹ä¸ºç»Ÿä¸€æµ…ç²‰è‰² */
            border: 1px solid var(--unified-pink); 
            border-radius: 6px;
        }
        .feedback {
            margin-top: 10px;
            font-weight: 600;
            height: 20px; 
            color: var(--danger-color);
        }

        /* --- æ·»åŠ æ–°å¡ç‰‡åŒºåŸŸ --- */
        .add-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            box-sizing: border-box;
            transition: all 0.2s;
        }
        input:focus {
            outline: none;
            border-color: var(--unified-pink); 
            box-shadow: 0 0 0 2px var(--unified-pink-light); 
        }

        .stats { margin-top: 10px; font-size: 0.9rem; color: #64748b; }
        
    </style>
</head>
<body>

    <h1>ğŸ“ æˆ‘çš„å•è¯æœ¬</h1>
    
    <div style="margin-bottom: 10px; width: 100%; max-width: 400px; text-align: left;">
        <label for="cardDeckSelect" style="display: block; font-size: 0.9rem; color: #64748b; margin-bottom: 5px;">é€‰æ‹©å¡ç»„/åˆ†ç±»:</label>
        <select id="cardDeckSelect" onchange="switchDeck()" style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #cbd5e1;">
            </select>
    </div>
    
    <div class="deck-controls">
        <button class="btn-new-deck" onclick="createNewDeck()">+ æ–°å¡ç»„</button>
        <button class="btn-warn" onclick="deleteDeck()">- åˆ é™¤å¡ç»„</button>
    </div>
    
    <div class="stats">å½“å‰: <span id="currentIndex">0</span> / æ€»æ•°: <span id="totalCount">0</span></div>

    <div class="scene" onclick="flipCard()">
        <div class="card" id="flashcard">
            <div class="card-face front">
                <span id="displayFront">Loading...</span>
                <div class="hint">ç‚¹å‡»ç¿»çœ‹ç­”æ¡ˆ</div>
            </div>
            <div class="card-face back">
                <span id="displayBack">...</span>
            </div>
        </div>
    </div>
    
    <div class="typing-section">
        <h3>âŒ¨ï¸ æ‰“å­—æ¨¡å¼ (ä¸­æ–‡ -> æ—¥è¯­)</h3>
        <div class="typing-input-group">
            <input type="text" id="answerInput" placeholder="è¯·è¾“å…¥æ—¥è¯­ç­”æ¡ˆ (æŒ‰ Enter æäº¤)" onkeydown="if(event.key === 'Enter') checkAnswer()">
            <button class="btn-check" onclick="checkAnswer()">æ£€æŸ¥ç­”æ¡ˆ</button>
        </div>
        <div id="feedback" class="feedback"></div>
    </div>


    <div class="controls">
        <button class="btn-nav" onclick="prevCard()">â† ä¸Šä¸€ä¸ª</button>
        <button class="btn-del" onclick="deleteCurrentCard()">åˆ é™¤è¿™å¼ </button>
        <button class="btn-nav" onclick="nextCard()">ä¸‹ä¸€ä¸ª â†’</button>
    </div>

    <hr style="width: 100%; max-width: 400px; border: 0; border-top: 1px solid #e2e8f0; margin-bottom: 20px;">

    <div class="add-section">
        <h3>æ·»åŠ åˆ°å¡ç»„ï¼š<span id="currentDeckDisplay" style="color: var(--unified-pink);">æˆ‘çš„è‡ªåˆ›è¯æ±‡</span></h3>
        <input type="text" id="inputFront" placeholder="æ­£é¢ (ä¸­æ–‡è¯æ±‡/æ„æ€)">
        <input type="text" id="inputBack" placeholder="èƒŒé¢ (æ—¥è¯­/å‡å/ç½—é©¬éŸ³)">
        <button class="btn-add" onclick="addNewCard()">æ·»åŠ å¹¶ä¿å­˜åˆ°å½“å‰å¡ç»„</button>
    </div>
    
    <script>
        // --- åˆå§‹æ•°æ®ï¼Œç”¨äºç¬¬ä¸€æ¬¡åŠ è½½ ---
        const initialDecks = {
            'æˆ‘çš„è‡ªåˆ›è¯æ±‡': [
                { front: "æ—¥è¯­", back: "æ—¥æœ¬èª" }, 
                { front: "åŠ æ²¹", back: "é ‘å¼µã‚‹" },
                { front: "æˆ‘", back: "ç§" }
            ],
            'JLPT N5 åŸºç¡€': [
                { front: "æ—©ä¸Šå¥½", back: "ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™" },
                { front: "è°¢è°¢", back: "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™" },
                { front: "äºº", back: "äºº" }
            ]
        };

        let allDecks = {}; 
        let currentDeckName = 'æˆ‘çš„è‡ªåˆ›è¯æ±‡'; 
        let cards = []; 
        let currentIndex = 0;

        // --- DOM å…ƒç´ å¼•ç”¨ ---
        const cardElement = document.getElementById('flashcard');
        const frontElement = document.getElementById('displayFront');
        const backElement = document.getElementById('displayBack');
        const deckSelect = document.getElementById('cardDeckSelect');
        const deckDisplay = document.getElementById('currentDeckDisplay');
        const answerInput = document.getElementById('answerInput');
        const feedbackElement = document.getElementById('feedback');


        // ====== æ ¸å¿ƒåŠŸèƒ½å‡½æ•°ï¼šä¿å­˜ä¸åŠ è½½ ======

        function saveDecks() {
            try {
                localStorage.setItem('myFlashcardsDecks', JSON.stringify(allDecks));
            } catch (e) {
                console.error("æ— æ³•ä¿å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨:", e);
                // ä»…åœ¨æœ¬åœ°æ–‡ä»¶è¿è¡Œæ—¶å¯èƒ½å‡ºç°æ­¤è­¦å‘Š
                alert("â— è­¦å‘Šï¼šæ— æ³•ä¿å­˜æ‚¨çš„å•è¯æ•°æ®ï¼\nå¦‚æœæ‚¨æ˜¯åœ¨çº¿è®¿é—®ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®ã€‚å¦‚æœæ˜¯æœ¬åœ°æ–‡ä»¶ï¼Œè¯·å°è¯•ä½¿ç”¨åœ¨çº¿æ‰˜ç®¡æœåŠ¡ï¼ˆå¦‚ GitHub Pagesï¼‰ã€‚");
            }
            updateUI();
        }

        function loadDecks() {
            const storedDecks = localStorage.getItem('myFlashcardsDecks');
            if (storedDecks) {
                allDecks = JSON.parse(storedDecks);
            } else {
                allDecks = initialDecks;
            }
            
            if (!allDecks[currentDeckName]) {
                currentDeckName = Object.keys(allDecks)[0] || 'æˆ‘çš„è‡ªåˆ›è¯æ±‡';
            }
            
            populateDeckSelect();
            switchDeck(currentDeckName);
        }

        // ====== æ ¸å¿ƒåŠŸèƒ½å‡½æ•°ï¼šUI æ›´æ–°ä¸å¯¼èˆª ======
        
        function updateUI() {
            cards = allDecks[currentDeckName] || [];
            const displayCards = cards.length === 0 ? [{front: `å¡ç»„ã€${currentDeckName}ã€‘`, back: "å¡ç‰‡ä¸ºç©ºï¼Œè¯·åœ¨ä¸‹æ–¹æ·»åŠ "}] : cards;
            
            currentIndex = Math.max(0, Math.min(currentIndex, cards.length - 1));
            
            document.getElementById('totalCount').innerText = cards.length;
            document.getElementById('currentIndex').innerText = cards.length === 0 ? 0 : currentIndex + 1;
            deckDisplay.innerText = currentDeckName; 
            feedbackElement.innerText = ''; 
            answerInput.value = ''; 

            if (cardElement.classList.contains('is-flipped')) {
                cardElement.classList.remove('is-flipped');
                setTimeout(() => setCardText(displayCards), 250);
            } else {
                setCardText(displayCards);
            }
            
            populateDeckSelect(); 
        }

        function setCardText(displayCards) {
            const actualIndex = Math.min(currentIndex, displayCards.length - 1);
            const currentCard = displayCards[actualIndex];
            
            frontElement.innerText = currentCard.front;
            backElement.innerText = currentCard.back.replace(/\s*\(.*\)/g, '');
            
            readText(currentCard.front, 'zh-CN'); 
        }

        window.flipCard = function() {
            cardElement.classList.toggle('is-flipped');
            const card = cards.length > 0 ? cards[currentIndex] : {front: "", back: "è¯·æ·»åŠ å¡ç‰‡"};
            
            if(cardElement.classList.contains('is-flipped')) {
                readText(card.back.replace(/\s*\(.*\)/g, ''), 'ja-JP'); 
            } else {
                readText(card.front, 'zh-CN'); 
            }
        }
        
        window.nextCard = function() {
            if (cards.length === 0) return; 
            if (currentIndex < cards.length - 1) {
                currentIndex++;
            } else {
                currentIndex = 0; 
            }
            updateUI();
        }

        window.prevCard = function() {
            if (cards.length === 0) return; 
            if (currentIndex > 0) {
                currentIndex--;
            } else {
                currentIndex = cards.length - 1; 
            }
            updateUI();
        }

        // ====== æ ¸å¿ƒåŠŸèƒ½å‡½æ•°ï¼šå¢åˆ æ”¹æŸ¥ ======
        
        window.addNewCard = function() {
            const f = document.getElementById('inputFront').value.trim();
            const b = document.getElementById('inputBack').value.trim();
            
            if (!f || !b) {
                alert("âš ï¸ é”™è¯¯æç¤ºï¼šæ­£é¢å’ŒèƒŒé¢éƒ½è¦å†™å“¦ï¼");
                return;
            }

            if (allDecks[currentDeckName]) {
                allDecks[currentDeckName].push({ front: f, back: b });
            } else {
                allDecks[currentDeckName] = [{ front: f, back: b }];
            }
            
            document.getElementById('inputFront').value = '';
            document.getElementById('inputBack').value = '';
            
            cards = allDecks[currentDeckName];
            currentIndex = cards.length - 1;
            saveDecks(); 
        }

        window.deleteCurrentCard = function() {
            if(cards.length === 0 || cards[currentIndex].front.includes('å¡ç»„ã€')) {
                alert("å½“å‰å¡ç»„ä¸­æ²¡æœ‰å¯åˆ é™¤çš„å•è¯ï¼");
                return;
            }
            
            if(confirm(`ç¡®å®šè¦ä»ã€${currentDeckName}ã€‘ä¸­åˆ é™¤è¿™å¼ å¡ç‰‡å—ï¼Ÿ`)) {
                allDecks[currentDeckName].splice(currentIndex, 1);
                
                cards = allDecks[currentDeckName];
                
                if (currentIndex >= cards.length) {
                    currentIndex = Math.max(0, cards.length - 1);
                }
                
                saveDecks(); 
                switchDeck(currentDeckName);
            }
        }

        // --- å¡ç»„ç®¡ç†å‡½æ•° ---
        
        function populateDeckSelect() {
            deckSelect.innerHTML = '';
            const deckNames = Object.keys(allDecks).sort();
            if (deckNames.length === 0) {
                 deckNames.push("è¯·æ·»åŠ æ–°å¡ç»„");
                 allDecks["è¯·æ·»åŠ æ–°å¡ç»„"] = [];
            }
            deckNames.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.innerText = `${name} (${allDecks[name].length})`;
                deckSelect.appendChild(option);
            });
            deckSelect.value = currentDeckName;
        }
        
        window.switchDeck = function(deckName = deckSelect.value) {
            currentDeckName = deckName;
            cards = allDecks[currentDeckName] || [];
            currentIndex = 0;
            
            if(cards.length === 0) {
                cards = [{front: `å¡ç»„ã€${currentDeckName}ã€‘`, back: "å¡ç‰‡ä¸ºç©ºï¼Œè¯·åœ¨ä¸‹æ–¹æ·»åŠ "}];
            }
            
            saveDecks(); 
        }

        window.createNewDeck = function() {
            const newName = prompt("è¯·è¾“å…¥æ–°å¡ç»„çš„åç§° (ä¾‹å¦‚: æ˜ŸæœŸ, å®¶å…·, N4è¯æ±‡):");
            if (newName && newName.trim() && !allDecks[newName.trim()]) {
                const trimmedName = newName.trim();
                allDecks[trimmedName] = [];
                currentDeckName = trimmedName;
                populateDeckSelect();
                saveDecks();
                switchDeck(currentDeckName);
            } else if (newName) {
                alert("å¡ç»„åç§°æ— æ•ˆæˆ–å·²å­˜åœ¨ï¼");
            }
        }

        window.deleteDeck = function() {
            const deckNames = Object.keys(allDecks);
            if (deckNames.length <= 1) {
                alert("è¿™æ˜¯æœ€åä¸€ä¸ªå¡ç»„ï¼Œä¸èƒ½åˆ é™¤ï¼è¯·æ‰‹åŠ¨åˆ é™¤å¡ç‰‡æˆ–æ–°å»ºå¡ç»„åå†åˆ é™¤ã€‚");
                return;
            }
            if (confirm(`âš ï¸ ç¡®å®šè¦åˆ é™¤æ•´ä¸ªå¡ç»„ã€${currentDeckName}ã€‘å—ï¼Ÿ\næ‰€æœ‰ ${allDecks[currentDeckName].length} å¼ å¡ç‰‡éƒ½å°†æ°¸ä¹…ä¸¢å¤±ï¼`)) {
                delete allDecks[currentDeckName];
                const remainingDeckNames = Object.keys(allDecks);
                currentDeckName = remainingDeckNames[0];
                saveDecks();
                populateDeckSelect(); 
                switchDeck(currentDeckName);
            }
        }
        
        // ====== æ‰“å­—æµ‹è¯•å’Œè¯­éŸ³åŠŸèƒ½ ======

        function readText(text, lang) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = lang; 
                speechSynthesis.speak(utterance);
            }
        }
        
        window.checkAnswer = function() {
            if (cards.length === 0 || cards[currentIndex].front.includes('å¡ç»„ã€')) {
                feedbackElement.innerText = "è¯·å…ˆæ·»åŠ å¡ç‰‡ï¼";
                return;
            }

            const card = cards[currentIndex];
            const actual = answerInput.value.toLowerCase().trim();
            
            const expected = card.back.toLowerCase().replace(/\s*\(.*\)/g, '').trim(); 
            
            if (actual === expected) {
                feedbackElement.innerText = "ğŸ‰ æ­£ç¡®ï¼";
                feedbackElement.style.color = 'var(--success-color)';
                
                setTimeout(() => {
                    nextCard();
                }, 700);
                
            } else {
                feedbackElement.innerText = "âŒ é”™è¯¯ï¼Œè¯·é‡è¯•æˆ–ç¿»è½¬å¡ç‰‡ã€‚";
                feedbackElement.style.color = 'var(--danger-color)';
            }
        }

        // å¯åŠ¨ï¼
        loadDecks();
    </script>
</body>
</html>
